if 'custom' not in globals():
    from mage_ai.data_preparation.decorators import custom

import subprocess

@custom
def transform_custom(*args, **kwargs):
    cmd = "cd /home/src/dbt && DBT_PROFILES_DIR=/home/src/dbt dbt build"
    print(f"▶ Ejecutando: {cmd}")
    result = subprocess.run(cmd, shell=True, capture_output=True, text=True)
    print(result.stdout)
    if result.returncode != 0:
        print(result.stderr)
        raise Exception("Error ejecutando dbt build")
    print("✅ DBT ejecutado correctamente.")
